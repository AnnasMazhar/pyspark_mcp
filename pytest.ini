[tool:pytest]
# Pytest configuration for PySpark Tools

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output options
addopts = 
    -v
    --tb=short
    --strict-markers
    --strict-config
    --color=yes
    --durations=10

# Markers for test categorization
markers =
    unit: Unit tests for individual functions/classes
    integration: Integration tests that test component interactions
    performance: Performance and benchmark tests
    slow: Tests that take a long time to run
    network: Tests that require network access
    docker: Tests that require Docker
    sql_converter: Tests for SQL converter module
    batch_processor: Tests for batch processor module
    duplicate_detector: Tests for duplicate detector module
    file_utils: Tests for file utilities module
    server: Tests for MCP server module
    memory_manager: Tests for memory manager module
    code_reviewer: Tests for code reviewer module
    parallel_safe: Tests safe for parallel execution
    sequential_only: Tests that must run sequentially
    flaky: Tests known to be flaky
    fast: Fast tests (< 5 seconds)
    medium: Medium tests (5-30 seconds)
    cached: Tests that use caching optimizations

# Test filtering
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:pyspark.*

# Coverage settings (when using pytest-cov)
# These can be overridden by command line options
# --cov=pyspark_tools
# --cov-report=term-missing
# --cov-report=html
# --cov-fail-under=25

# Minimum version requirements
minversion = 8.0

# Test timeout (in seconds)
timeout = 300

# Parallel execution settings (when using pytest-xdist)
# -n auto  # Use all available CPU cores
# -n 4     # Use 4 processes
# --dist worksteal  # Use work-stealing for better load balancing

# Log capture settings
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Temporary directory settings
tmp_path_retention_count = 3
tmp_path_retention_policy = failed